# ü§ñ Nichols: O Assistente Cidad√£o (Core do WhatsApp)

> **Respons√°vel:** Nichols
> **Miss√£o:** "Traduzir a democracia". Ser a interface amig√°vel, auditiva e inteligente que conecta a 'Dona Maria' √†s leis.

## üéØ Objetivo do M√≥dulo
Este √© o c√©rebro da intera√ß√£o em tempo real. O m√≥dulo `nichols` deve receber mensagens desestruturadas (√°udio/texto), compreender a inten√ß√£o, consultar fontes oficiais (RAG) e responder de forma emp√°tica e acess√≠vel.

### üîó Conex√£o com Regras de Neg√≥cio
* **Inclus√£o Digital:** Prioridade total para √ÅUDIO (Whisper + TTS). A persona n√£o gosta de ler text√£o.
* **Combate √† Desinforma√ß√£o:** Respostas baseadas em fatos (RAG), nunca em alucina√ß√£o pura.
* **Sem Barreira:** Zero login. O ID √© o n√∫mero de telefone (`remoteJid`).

---

## üõ† Especifica√ß√£o T√©cnica

### Stack
* **Framework:** Python FastAPI (Async √© vital para n√£o travar com I/O da OpenAI).
* **STT (Speech-to-Text):** OpenAI Whisper API.
* **LLM:** GPT-4o-mini (Custo-benef√≠cio) ou GPT-4o (Precis√£o).
* **TTS (Text-to-Speech):** OpenAI TTS (`model="tts-1"`, `voice="onyx"` ou `"alloy"`).
* **Vector DB:** ChromaDB (Local/Persistente).
* **WPP Client:** Webhook recebendo payload da Evolution API ou WPPConnect.

### üåä Fluxo de Dados (Pipeline)

```mermaid
sequenceDiagram
    participant User as Dona Maria (WhatsApp)
    participant API as Nichols API (FastAPI)
    participant AI as OpenAI (Whisper/GPT/TTS)
    participant DB as ChromaDB (RAG)

    User->>API: Envia √Åudio ("√â verdade que v√£o taxar o Pix?")
    API->>AI: Envia √°udio para Whisper
    AI-->>API: Retorna texto transcrito
    
    rect rgb(240, 240, 240)
        Note right of API: Decis√£o Inteligente
        API->>API: Classifica Inten√ß√£o (D√∫vida vs. Papo)
        API->>DB: Busca semanticamente "Taxa√ß√£o Pix"
        DB-->>API: Retorna contexto (Leis/Not√≠cias Reais)
    end
    
    API->>AI: Prompt (System + Contexto + D√∫vida)
    AI-->>API: Resposta Texto ("N√£o √© verdade...")
    API->>AI: Converte Resposta para √Åudio (TTS)
    AI-->>API: Retorna Arquivo .mp3
    API->>User: Envia √Åudio Explicativo
````

### üß† Detalhes de Implementa√ß√£o

#### 1\. System Prompt (A "Alma" do Bot)

O prompt deve ser configurado para **jamais** ser elitista.

> *"Voc√™ √© um assistente c√≠vico, neutro e amigo. Voc√™ explica leis complexas como se estivesse conversando na fila da padaria. Use analogias simples. Se a lei impacta o bolso, avise primeiro. Nunca invente leis."*

#### 2\. RAG (Retrieval-Augmented Generation)

N√£o tente indexar o mundo. Para o MVP:

  * Crie uma pasta `data/` com 5 PDFs/TXTs de leis pol√™micas atuais.
  * No startup da aplica√ß√£o, o script deve ler esses arquivos e popular o ChromaDB.

#### 3\. Output

  * Sempre envie o TEXTO curto + o √ÅUDIO.
  * Sempre cite a fonte no final do texto (ex: *"Fonte: C√¢mara dos Deputados, PL 123/23"*).

-----

## ‚úÖ Definition of Done (DoD) - Dia 1

  - [ ] Webhook recebe mensagem "Oi".
  - [ ] Responde com texto fixo.
  - [ ] Responde convertendo texto para √°udio.

<!-- end list -->

````