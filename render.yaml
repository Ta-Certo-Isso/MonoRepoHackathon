# render.yaml - Blueprint do backend Nichols no Render

services:
  - type: web
    name: ta-certo-isso-nichols
    plan: free
    runtime: python

    # monorepo: o código do FastAPI está em /Nichols
    rootDir: Nichols

    buildCommand: "pip install -r requirements.txt"
    startCommand: "uvicorn main:app --host 0.0.0.0 --port $PORT"

    autoDeploy: no  # quem dispara o deploy será o GitHub Actions

    envVars:
      # ==== OpenAI ====
      - key: OPENAI_API_KEY
        sync: false
      - key: OPENAI_MODEL
        value: gpt-4o-mini
      - key: OPENAI_TTS_MODEL
        value: tts-1
      - key: OPENAI_TTS_VOICE
        value: alloy
      - key: OPENAI_EMBEDDINGS_MODEL
        value: text-embedding-3-small

      # ==== Evolution API ====
      - key: EVOLUTION_BASE_URL
        sync: false      # ex: https://seu-evolution.com ou URL do túnel
      - key: EVOLUTION_API_KEY
        sync: false
      - key: EVOLUTION_INSTANCE
        sync: false

      # ==== RAG & Histórico ====
      - key: DATA_DIR
        value: data
      - key: HISTORY_DB
        value: data/history.db

      # ==== Segurança do webhook ====
      - key: WEBHOOK_TOKEN
        sync: false
